/*!CK:1107173305!*//*1424144298,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["AMlbU"]); }

__d("ItunesPluginLogging",["Run","Bootloader"],function(a,b,c,d,e,f,g){var h={logPluginData:function(){g.onAfterLoad(function(){var i=b('Bootloader');i.loadModules(["ItunesDetector","AsyncRequest"],function(j,k){new k().setURI('/ajax/ads/media/log').setData({status:j.hasItunes()}).send();});});}};e.exports=h;},null);
__d("BuddyListNub",["Arbiter","AvailableList","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatConfig","ChatSidebar","ChatVisibility","CSS","Dock","DOM","Event","JSLogger","JSXDOM","KeyEventController","Keys","NubController","OrderedFriendsList","Parent","PresencePrivacy","PresenceStatus","Toggler","csx","cx","setTimeoutAcrossTransitions","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){var ga=32,ha=s.create('buddylist_nub');for(var ia in w)if(w.hasOwnProperty(ia))ka[ia]=w[ia];var ja=w===null?null:w.prototype;ka.prototype=Object.create(ja);ka.prototype.constructor=ka;ka.__superConstructor__=w;function ka(la,ma,na){"use strict";w.call(this);ja.init.call(this,la);this.root=la;this.orderedList=ma;this.typeahead=na;this.button=q.find(la,'a.fbNubButton');this.unreadCount=q.find(la,"span._5ayx");this.label=q.find(la,'span.label');this.body=q.scry(la,'div.fbNubFlyoutBody')[0];this.container=y.byClass(la,"_56ox");this.typeaheadContainer=q.find(la,'.fbChatTypeaheadViewContainer');var oa=q.find(la,'div.fbNubFlyoutTitlebar');ba.createInstance(oa).setSticky(false);ma.subscribe('render',this.flyoutContentChanged.bind(this));ma.setScrollContainer(this.body);h.subscribe('buddylist/availability-changed',this._updateCount.bind(this));g.subscribe('chat/connect',this._handleConnect.bind(this));g.subscribe('chat/option-changed',function(pa,qa){if(qa.name=='hide_groups')this.onResize();}.bind(this));z.subscribe('privacy-user-presence-changed',this._handleVisibilityChange.bind(this));this.message=q.find(la,"div._4mq1");this.warningMsgText=null;this.warningMsgEventListener=null;this.showWarningTimeout=null;j.subscribe(j.CONNECTED,this._handleChannelConnected.bind(this));j.subscribe(j.SHUTDOWN,this._handleChannelShutdown.bind(this));j.subscribe(j.RECONNECTING,this._handleChannelReconnecting.bind(this));j.subscribe([j.MUTE_WARNING,j.UNMUTE_WARNING],this._updateView.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.subscribe('resize',this.onResize.bind(this));r.listen(la,'keydown',this._onKeyDown.bind(this));r.listen(this.button,'click',this.onButtonClick.bind(this));u.registerKey('q',function(event){if(this._isOpen){na.getCore().getElement().focus();}else{this.onButtonClick();this.show();}event.prevent();}.bind(this));na.getCore().subscribe('escape',this.hide.bind(this));na.subscribe(['respond','reset'],function(pa,qa){if(this._isOpen){if(qa&&qa.value&&qa.value===na.getCore().getValue()&&na.getView().isVisible()){p.setUseMaxHeight(this.root,false);this._hideBuddyList();}else this._showBuddyList();this.flyoutContentChanged();}}.bind(this));g.subscribe('sidebar/show',this.hide.bind(this));g.subscribe('minisidebar/show',this.hide.bind(this));g.subscribe('sidebar/hide',this._onSidebarHide.bind(this));this._orderedListCount=x.getList().length;g.inform('buddylist-nub/initialized',this,g.BEHAVIOR_PERSISTENT);this._handleVisibilityChange();ha.log('buddylist_initialized');}ka.prototype.getButton=function(){"use strict";return this.button;};ka.prototype.getRoot=function(){"use strict";return this.root;};ka.prototype._handleConnect=function(la){"use strict";this._updateView(true);};ka.prototype._getShutdownReason=function(la){"use strict";switch(la){case k.HINT_AUTH:return "Your session has timed out. Please log in.";case k.HINT_CONN:return fa._("Facebook {Chat} is currently unavailable.",[fa.param("Chat","Chat")]);case k.HINT_MAINT:return fa._("Facebook {Chat} is currently down for maintenance.",[fa.param("Chat","Chat")]);default:return fa._("Facebook {Chat} is currently unavailable.",[fa.param("Chat","Chat")]);}};ka.prototype._getReconnectMsg=function(la){"use strict";var ma;if(la===null||false===navigator.onLine){ma="Unable to connect to chat. Check your Internet connection.";}else if(la>l.get('warning_countdown_threshold_msec')){var na=q.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again"),oa=q.create('div',null,na),pa=oa.innerHTML;ma=fa._("Unable to connect to chat. {try-again-link}",[fa.param("try-again-link",pa)]);}else if(la>1000){ma=fa._("Unable to connect to chat. Reconnecting in {seconds}...",[fa.param("seconds",Math.floor(la/1000))]);}else ma="Unable to connect to chat. Reconnecting...";return ma;};ka.prototype._resetShowWarningTimeout=function(){"use strict";if(this.showWarningTimeout){clearTimeout(this.showWarningTimeout);this.showWarningTimeout=null;}};ka.prototype._handleChannelConnected=function(la){"use strict";this._resetShowWarningTimeout();if(this.orderedList.isVisible())n.goOnline();this.warningMsgText=null;this._updateView();};ka.prototype._handleChannelShutdown=function(la,ma){"use strict";this._resetShowWarningTimeout();this.warningMsgText=this._getShutdownReason(ma);this._updateView();};ka.prototype._handleChannelReconnecting=function(la,ma){"use strict";this._resetShowWarningTimeout();this.warningMsgText=this._getReconnectMsg(ma);if(ma>1000){if(ma>l.get('warning_countdown_threshold_msec')){if(this.warningMsgEventListener){this.warningMsgEventListener.remove();this.warningMsgEventListener=null;}this.warningMsgEventListener=r.listen(this.message,'click',function(event){if(o.hasClass(event.getTarget(),'fbChatReconnectLink')){this._tryReconnect();event.kill();}}.bind(this));}this.showWarningTimeout=ea(this._handleChannelReconnecting.bind(this,la,ma-1000),1000);}this._updateView();};ka.prototype._tryReconnect=function(){"use strict";if(j.disconnected())j.reconnect();};ka.prototype._handleVisibilityChange=function(){"use strict";this._updateView();if(i.shouldShow()){if(n.hasBlackbirdEnabled()){i.showBlackbirdDialog(this.getButton(),z.getVisibility());}else if(!n.isOnline())i.showOfflineDialog(this.getButton());}else i.hide();if(!n.isOnline())this.hide();};ka.prototype._updateView=function(la){"use strict";var ma=this.container;if(ma){o.conditionClass(ma,'offline',!n.isOnline());o.conditionClass(ma,'error',j.disconnected());}if(j.disconnected())q.setContent(this.message,this.warningMsgText);var na,oa;if(!n.isOnline()){na=fa._("{Chat} (Off)",[fa.param("Chat","Chat")]);}else if(j.disconnected()){na=fa._("{Chat} (Disconnected)",[fa.param("Chat","Chat")]);}else{var pa=aa.getOnlineCount();if(pa){var qa=t.span({className:"count"},"(",pa,")");na=fa._("{Chat} {number-available}",[fa.param("Chat","Chat"),fa.param("number-available",qa)]);}else{na="Chat";oa=true;}}this._setUnread(this._unreadMessageCount);this._setLabel(na,oa);this.buttonContentChanged();};ka.prototype.onButtonClick=function(){"use strict";if(o.shown(this.typeahead.getElement())){var la=this.subscribe('show',function(){this.typeahead.getCore().getElement().focus();i.dismiss();}.bind(this));setTimeout(this.unsubscribe.bind(this,la),0);}};ka.prototype.onHide=function(){"use strict";this._isOpen=false;if(this._buddyListRenderSubscription){this.orderedList.unsubscribe(this._buddyListRenderSubscription);this._buddyListRenderSubscription=null;}this._hideBuddyList();this.typeahead.getCore().reset();};ka.prototype._onKeyDown=function(event){"use strict";var la=r.getKeyCode(event);if(la===v.ESC&&!o.hasClass(this.root,'menuOpened')){this.hide();return false;}else if(la==v.RETURN)m.enable();};ka.prototype._onSidebarHide=function(event){"use strict";this.getButton().focus();};ka.prototype.onResize=function(){"use strict";var la=p.getMaxFlyoutHeight(this.root)-60,ma=Math.max(250,la);this.orderedList.setNumTopFriends(Math.floor(ma/ga));};ka.prototype._showBuddyList=function(){"use strict";if(!this._buddyListRenderSubscription)this._buddyListRenderSubscription=this.orderedList.subscribe('render',p.setUseMaxHeight.bind(p,this.root,false));o.hide(this.typeaheadContainer);this.orderedList.show();ha.bump('buddylist_show');};ka.prototype._hideBuddyList=function(){"use strict";o.show(this.typeaheadContainer);this.orderedList.hide();ha.bump('buddylist_hide');};ka.prototype.onShow=function(){"use strict";this._isOpen=true;if(j.disconnected()){this._tryReconnect();this._showBuddyList();}else n.goOnline(this._showBuddyList.bind(this));};ka.prototype._setLabel=function(la,ma){"use strict";var na=this.label.cloneNode(true);q.setContent(na,la);q.replace(this.label,na);this.label=na;this.throbber&&o.conditionShow(this.throbber,!!ma);};ka.prototype._setUnread=function(la){"use strict";o.conditionShow(this.unreadCount,!!la);if(la){la=t.span({className:"_51jx _5ayw"},la);q.setContent(this.unreadCount,la);}};ka.prototype._updateCount=function(){"use strict";this._updateView();};e.exports=ka;},null);
__d("ChatTypeaheadDataSource",["BanzaiLogger","CurrentUser","DataSource","JSLogger","MercuryParticipantTypes","OrderedFriendsList","Promise","Deferred","ShortProfiles","debounce","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=500;for(var s in i)if(i.hasOwnProperty(s))u[s]=i[s];var t=i===null?null:i.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=i;function u(v){"use strict";v=v||{};v.kanaNormalization=true;i.call(this,v);this._jslog=j.create('chat_typeahead');this._jslog.log('created');this._bootstrapPromise=new n();this._queryPromise=new n();m.all([this._bootstrapPromise,this._queryPromise]).then(this._logWaitTime);this._needsFriends=true;this._logQuery=p(function(w,x){this._queryPromise.resolve(Date.now()-r);this._jslog.log('query',{query:w,success:x});},r,this,true);this._logRespond=p(function(w,x){this._jslog.log('respond',{query:w,results:x});},r,this,true);}u.prototype.init=function(){"use strict";this._jslog.log('init');t.init.call(this);this._update();};u.prototype.bootstrap=function(){"use strict";this._jslog.log('bootstrap');t.bootstrap.call(this);o.fetchAll().then(function(){this._bootstrapPromise.resolve(Date.now());this.inform('activity',{activity:false});this._needsFriends=false;this._update();}.bind(this));};u.prototype.query=function(v,w,x,y){"use strict";var z=t.query.call(this,v,w,x,y);this._logQuery(v,z);return z;};u.prototype.respond=function(v,w,x){"use strict";var y=t.respond.call(this,v,w,x);this._logRespond(v,w);return y;};u.prototype.getQueryData=function(v,w){"use strict";return q(t.getQueryData.call(this,v,w),{needs_friends:this._needsFriends});};u.prototype.fetchAll=function(){"use strict";o.fetchAll();};u.prototype._update=function(){"use strict";var v=this.value,w=o.getCachedProfileIDs(),x=w.filter(function(z){var aa=o.getNow(z);return (z==h.getID()||aa.type===k.FRIEND);}),y=x.map(function(z){var aa=o.getNow(z),ba=z==h.getID()?k.FRIEND:aa.type,ca=[aa.additionalName,aa.alternateName].concat(aa.searchTokens||[]).join(' ');return {uid:z,index:l.getActiveRank(z),text:aa.name,tokens:ca,localized_text:aa.name,additional_text:aa.additionalName,photo:aa.thumbSrc,type:ba};});if(y.length)this.addEntries(y);this.value=v;if(v)this.query(v);};u.prototype.refreshData=function(){"use strict";this.fetchAll();d(['AvailableList'],function(v){v.update();}.bind(this));};u.prototype._logWaitTime=function(v){"use strict";var w=v[0],x=v[1];g.log('ChatTypeaheadLoggerConfig',{wait_time:w-x});};e.exports=u;},null);
__d("legacy:ChatTypeaheadBehavior",["ChatTypeaheadBehavior"],function(a,b,c,d,e,f,g){if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.chatTypeahead=function(h){h.enableBehavior(g);};},3);
__d("NotificationImpressions",["AsyncSignal","NotificationTokens","URI"],function(a,b,c,d,e,f,g,h,i){var j='/ajax/notifications/impression.php';function k(l,m){var n={ref:m};h.untokenizeIDs(l).forEach(function(o,p){n['alert_ids['+p+']']=o;});new g(i(j).getQualifiedURI().toString(),n).send();}e.exports={log:k};},null);
__d("NotificationBeeperItemContents.react",["Animation","AsyncRequest","Bootloader","CloseButton.react","ImageBlock.react","NotificationURI","NotificationUserActions","React","TextWithEntities.react","Timestamp.react","URI","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(u,v){return n.createElement("span",{className:"fwb"},u);}var t=n.createClass({displayName:"NotificationBeeperItemContents",_markAsRead:function(){m.markNotificationsAsRead([this.props.beep.notificationID]);},_onClick:function(u){this._markAsRead();this.props.onHide();if(u.button===1||u.altKey||u.ctrlKey||u.metaKey||u.shiftKey)return;var v=this.props.beep,w=q(v.url).getPath();if(l.isAlbumDraftRecoveryDialogURI(v.link)){new h(v.link).send();u.preventDefault();}else if(v.photo&&l.snowliftable(v.link)){i.loadModules(["PhotoSnowlift"],function(x){x.bootstrap(v.link,u.currentTarget);});u.preventDefault();}else if(v.ajaxifyLink){i.loadModules(["AsyncDialog"],function(x){x.bootstrap(v.ajaxifyLink,u.currentTarget,'dialog');});u.preventDefault();}},_onClose:function(){this._markAsRead();this.props.onHide();},_doFlash:function(){new g(this.refs.inner.getDOMNode()).from('opacity','0').to('opacity','1').duration(200).go();},componentDidMount:function(){this.props.onReadyToHide(this.props.beep.notificationID);},componentDidUpdate:function(u){if(u.beep.beepID!==this.props.beep.beepID){this._doFlash();this.props.onReadyToHide(this.props.beep.notificationID);}},render:function(){var u=this.props.beep;return (n.createElement("div",{ref:"inner"},n.createElement(j,{className:"_3soc",onClick:this._onClose,size:"medium"}),n.createElement("a",{href:u.link,onClick:this._onClick,className:"_3soi"},n.createElement(k,{className:"_3soj",spacing:"medium"},n.createElement("img",{src:u.actors[0].profile_picture.uri,className:"_3sok"}),n.createElement("div",{className:"_3sol"},n.createElement(o,{renderEmoticons:true,renderEmoji:true,interpolator:s,ranges:u.text.ranges,aggregatedranges:u.text.aggregated_ranges,text:u.text.text}),n.createElement(k,{className:"_3som"},n.createElement("img",{className:"_1x8t",src:u.icon.uri}),n.createElement(p,{time:u.timestamp.time,text:u.timestamp.text,verbose:u.timestamp.verbose})))))));}});e.exports=t;},null);
__d("NotificationBeeperConst",["keyMirror"],function(a,b,c,d,e,f,g){var h={IDLE_DELAY:10000,ACTIVE_DELAY_LONG:4000,FADE_OUT_LENGTH:1500,BeepStates:g({PENDING:true,RENDERED:true,READY_TO_HIDE:true,FADING_OUT:true})};e.exports=h;},null);
__d("NotificationBeeperItem.react",["Animation","BrowserSupport","NotificationBeeperItemContents.react","React","NotificationBeeperItemRenderersList","Style","NotificationBeeperConst","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=j.createClass({displayName:"NotificationBeeperItem",getInitialState:function(){return {fadedIn:false,hidden:false};},componentDidMount:function(){var q;if(h.hasCSSAnimations()){q=this.setState.bind(this,{fadedIn:true},null);}else q=function(){new g(this.refs.item.getDOMNode()).from('top','-30px').from('opacity','0').to('top','0px').to('opacity','1').duration(200).ondone(this.setState.bind(this,{fadedIn:true},null)).go();}.bind(this);o(q,50);this.props.onInserted(this.props.beep);},componentWillUnmount:function(){if(this._fadeOutAnimation){this._fadeOutAnimation.stop();this._fadeOutAnimation=null;}},_onHide:function(){this.setState({hidden:true});},render:function(){var q=this.props.beep,r=(("_3sod")+(this.state.fadedIn?' '+"_3soe":'')+(this.state.hidden?' '+"_3sof":'')),s=this._getRenderer(q.beepRenderer);return (j.createElement("li",{className:r,ref:"item","data-gt":q.tracking},j.createElement(s,{beep:q,onHide:this._onHide,onReadyToHide:this.props.onReadyToHide,ref:"itemContents"})));},componentDidUpdate:function(q,r,s){if(this.props.fadingOut){if(!this._fadeOutAnimation)this._fadeOutAnimation=new g(this.refs.item.getDOMNode()).from('opacity','1').to('opacity','0').duration(m.FADE_OUT_LENGTH).ondone(this._onHide).go();this.refs.item.getDOMNode().style.transitionDuration='0ms';}else if(this._fadeOutAnimation){this._fadeOutAnimation.stop();this._fadeOutAnimation=null;l.set(this.refs.item.getDOMNode(),'opacity','1');}},_getRenderer:function(q){if(q in k)return k[q];return i;}});e.exports=p;},null);
__d("NotificationSound",["Sound","copyProperties"],function(a,b,c,d,e,f,g,h){var i=5000;g.init(['audio/mpeg']);function j(k){this._soundPath=k;this._lastPlayed=0;}h(j.prototype,{play:function(k){if(!this._soundPath)return;var l=Date.now();if((l-this._lastPlayed)<i)return;this._lastPlayed=l;g.play(this._soundPath,k);}});e.exports=j;},null);
__d("NotificationBeeper.react",["Arbiter","ChannelConstants","NotificationBeeperItem.react","NotificationConstants","NotificationImpressions","NotificationPhotoThumbnail","NotificationSound","NotificationUpdates","NotificationURI","NotificationUserActions","React","NotificationBeeperConst","NotificationBeeperPinnedPostLoader","cx","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=r.BeepStates,x='beeper',y=j.PayloadSourceType.LIVE_SEND,z=j.PayloadSourceType.OTHER_APPLICATION,aa=q.createClass({displayName:"NotificationBeeper",propTypes:{},getInitialState:function(){return {soundEnabled:this.props.soundEnabled,hovering:false,fading:false,beeps:{}};},componentWillMount:function(){var ba=h.getArbiterType('notif_sound_pref_changed'),ca='update-notifications';this.subscriptions=[n.subscribe(ca,function(da,ea){if(ea.payloadsource===y||ea.payloadsource===z){var fa=ea.nodes;if(fa&&fa.length)this._handleBeepChanges(this._convertNotifications(fa));}}.bind(this)),g.subscribe(ba,function(da,ea){this.setState({soundEnabled:ea.obj.enabled});}.bind(this))];g.inform('NotificationBeeper/mounted',null,g.BEHAVIOR_PERSISTENT);if(s.payload)this._handleBeepChanges(this._convertNotifications(s.payload.nodes));},componentWillUnmount:function(){this.subscriptions.forEach(function(ba){ba.unsubscribe();});this.subscriptions=null;},_onMouseEnter:function(){this._hideWait&&clearTimeout(this._hideWait);var ba=[],ca=this.state.beeps;Object.keys(ca).forEach(function(da){if(ca[da].state!=w.PENDING){ba.push(da);}else ca[da].state=w.RENDERED;});p.markNotificationsAsSeen(ba);this.setState({hovering:true,fading:false,beeps:ca});},_onMouseLeave:function(){this._waitToHide(r.ACTIVE_DELAY_LONG);this.setState({hovering:false});},_onInsertedItem:function(ba){if(!this.state.hovering)this._waitToHide();if(this.state.soundEnabled&&ba.sound){if(!this._notifSound)this._notifSound=new m(this.props.soundPath);this._notifSound.play(ba.beepID);}if(this.props.shouldLogImpressions)k.log([ba.notificationID],x);},_waitToHide:function(ba){this._hideWait&&clearTimeout(this._hideWait);this._hideWait=u(v(this._hide,this),ba||r.IDLE_DELAY);},_onReadyToHide:function(ba){this.state.beeps[ba].state=w.READY_TO_HIDE;if(!this._hideWait)this._waitToHide();},_hide:function(){this._hideWait=null;var ba=this.state.beeps;Object.keys(ba).forEach(function(ca){if(ba[ca].state==w.READY_TO_HIDE)ba[ca].state=w.FADING_OUT;});this.setState({fading:true});u(v(this._finishHide,this),r.FADE_OUT_LENGTH);},_finishHide:function(){if(!this.state.fading)return;var ba=this.state.beeps;Object.keys(ba).forEach(function(ca){if(ba[ca].state==w.FADING_OUT)delete ba[ca];});this.setState({fading:false,beeps:ba});u(function(){var ca=this.state.beeps;Object.keys(ca).forEach(function(da){if(ca[da].state==w.PENDING)ca[da].state=w.RENDERED;});this.setState({beeps:ca});}.bind(this));},_handleBeepChanges:function(ba){var ca=this.state.fading?w.PENDING:w.RENDERED,da=this.state.beeps,ea=false;Object.keys(ba).reverse().forEach(function(fa){var ga={state:ca,data:ba[fa]};if(!da[fa]||da[fa].data.beepID!=ga.data.beepID){if(da[fa]){ea=true;if(ga.data.beepUpdatesOnTop)delete da[fa];}da[fa]=ga;}});if(ea)this._waitToHide();this.forceUpdate();},render:function(){var ba=this.state.beeps,ca=[];Object.keys(ba).reverse().forEach(function(fa){var ga=ba[fa];if(ga.state==w.PENDING)return;ca.push(q.createElement(i,{key:fa,fadingOut:this.state.fading&&ga.state==w.FADING_OUT,beep:ga.data,onInserted:this._onInsertedItem,onReadyToHide:this._onReadyToHide}));},this);var da=ca.length>0,ea=((!da?"hidden_elem":'')+(' '+"_50d1"));return (q.createElement("ul",{ref:"container",className:ea,"data-gt":this.props.tracking,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},ca));},_convertNotifications:function(ba){var ca={};ba.forEach(function(da){if(!da.showBeep)return;var ea=da.alert_id,fa=ea+'-'+da.receivedTime,ga=l.getThumbnail(da.attachments,da.attached_story),ha=ca[ea]={notificationID:ea,notifID:da.id,beepID:fa,beepRenderer:da.beepRenderer,rendererData:da.rendererData,beepUpdatesOnTop:da.beepUpdatesOnTop,actors:da.unaggregatedActors||da.actors,icon:da.icon,link:da.url?o.localize(da.url):'#',url:da.url,ajaxifyLink:da.ajaxify_url,photo:ga,text:da.unaggregatedTitle||da.title,timestamp:da.timestamp,receivedTime:da.receivedTime,sound:!!da.sound,tracking:da.tracking};});return ca;}});e.exports=aa;},null);
/**
 * @generated SignedSource<<623c7cbcff19956af736c3d064fc689d>>
 *
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 *
 * Copyright (C) 2010 by Johannes Baagoe <baagoe@baagoe.org>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @providesModule Alea
 * @preserve-header
 */__d("Alea",[],function(a,b,c,d,e,f){function g(){var i=4022871197,j=function(k){k=k.toString();for(var l=0;l<k.length;l++){i+=k.charCodeAt(l);var m=.02519603282416938*i;i=m>>>0;m-=i;m*=i;i=m>>>0;m-=i;i+=m*4294967296;}return (i>>>0)*2.3283064365386963e-10;};j.version='Mash 0.9';return j;}function h(){return (function(i){var j=0,k=0,l=0,m=1;if(i.length===0)i=[new Date()];var n=new g();j=n(' ');k=n(' ');l=n(' ');for(var o=0;o<i.length;o++){j-=n(i[o]);if(j<0)j+=1;k-=n(i[o]);if(k<0)k+=1;l-=n(i[o]);if(l<0)l+=1;}n=null;var p=function(){var q=2091639*j+m*2.3283064365386963e-10;j=k;k=l;l=q-(m=q|0);return l;};p.version='Alea 0.9';p.args=i;return p;}(Array.prototype.slice.call(arguments)));}e.exports=h;},null);
__d("BanzaiScribe",["Banzai"],function(a,b,c,d,e,f,g){function h(j){return {log:function(k,l,m){var n=[l];if(m!=null)n.push(m);g.post('scribe:'+k,n,j);}};}var i=h({});i.create=h;e.exports=i;},null);
__d("MissedVideoCallHandler",["AsyncRequest","Dialog","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i){var j={_missedCallDialog:null,_shouldSuppressMissedCallDialogs:false,onMissedCall:function(k,l){if(!i.isVideoCallSupported()||this._shouldSuppressMissedCallDialogs)return;var m='/ajax/chat/video/missed_call.php?idTarget='+k.from,n=new h().setAsync(new g(m));if(l){this._missedCallDialog=n;}else{n.show();this._shouldSuppressMissedCallDialogs=true;}},showDialog:function(){if(!!this._missedCallDialog){this._missedCallDialog.show();this._shouldSuppressMissedCallDialogs=true;}},resetDialog:function(){this._missedCallDialog=null;},setSuppressAll:function(k){this._shouldSuppressMissedCallDialogs=k;}};e.exports=j;},null);
__d("FBRTCIceCache",[],function(a,b,c,d,e,f){function g(){"use strict";this.$FBRTCIceCache0={};}g.prototype.reset=function(h,i){"use strict";if(!this.$FBRTCIceCache0[h])this.$FBRTCIceCache0[h]={};this.$FBRTCIceCache0[h][i]=[];};g.prototype.cacheCandidate=function(h,i,j){"use strict";if(!this.$FBRTCIceCache0[h])this.$FBRTCIceCache0[h]={};if(!this.$FBRTCIceCache0[h][i])this.$FBRTCIceCache0[h][i]=[];this.$FBRTCIceCache0[h][i].unshift(j);};g.prototype.drainCandidates=function(h,i,j){"use strict";if(this.$FBRTCIceCache0[h]&&this.$FBRTCIceCache0[h][i]){var k;while(this.$FBRTCIceCache0[h][i].length>0){k=this.$FBRTCIceCache0[h][i].pop();j(k);}}};e.exports=g;},null);
__d("XIncomingCallDialogController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/videocall\/incoming\/",{user_id:{type:"Int",required:true},call_id:{type:"Int"},__asyncDialog:{type:"Int"}});},null);
__d("FBRTCIncomingCall",["AsyncDialog","AsyncRequest","Dialog","MissedVideoCallHandler","setTimeoutAcrossTransitions","XIncomingCallDialogController","FBRTCSoundController"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=70000;function o(p,q,r,s){"use strict";this.peerID=p;this.callID=q;this.callSummary=r;this.offerMsg=s;this.ringing=false;this.$FBRTCIncomingCall0=null;}o.prototype.showIncomingDialog=function(){"use strict";var p=i.getCurrent();if(p)p.hide();j.setSuppressAll(true);this.ringing=true;this.timeout=k(this.$FBRTCIncomingCall1.bind(this),n);var q=l.getURIBuilder().setInt('user_id',this.peerID).setInt('call_id',this.callID).getURI();this.$FBRTCIncomingCall0=new h(q);g.send(this.$FBRTCIncomingCall0,this.$FBRTCIncomingCall2.bind(this));};o.prototype.$FBRTCIncomingCall2=function(p){"use strict";this.$FBRTCIncomingCall0=null;this.view=p;p.subscribe('confirm',this.$FBRTCIncomingCall3.bind(this));p.subscribe('cancel',this.$FBRTCIncomingCall4.bind(this));m.playIncomingRingtone(this.callID,this.peerID,true);j.setSuppressAll(false);};o.prototype.cancel=function(){"use strict";if(this.$FBRTCIncomingCall0){this.$FBRTCIncomingCall0.abort();this.$FBRTCIncomingCall0=null;}if(this.timeout)clearTimeout(this.timeout);if(this.view){this.view.hide();this.view=null;}m.stopIncomingRingtone();this.ringing=false;};o.prototype.isForPeer=function(p){"use strict";return this.peerID===p;};o.prototype.isForPeerAndCall=function(p,q){"use strict";return (this.peerID===p)&&(this.callID===q);};o.prototype.$FBRTCIncomingCall3=function(p,q){"use strict";this.cancel();if(this.onAnswer)this.onAnswer(this.peerID,this.callID,this.offerMsg,this.callSummary,q.value);};o.prototype.$FBRTCIncomingCall4=function(){"use strict";this.cancel();if(this.onIgnore)this.onIgnore(this.peerID,this.callID,this.callSummary);};o.prototype.$FBRTCIncomingCall1=function(){"use strict";this.cancel();if(this.onTimeout)this.onTimeout(this.peerID,this.callID,this.callSummary);};e.exports=o;},null);
__d("FBRTCLocalMessageQueue",["CacheStorage","FBRTCLogger","randomInt"],function(a,b,c,d,e,f,g,h,i){var j='localstorage',k='RTC_',l='offer',m='data_',n='last_write_index',o='session_id',p=30*1000,q=20*1000,r=15*1000,s=500;function t(){"use strict";this.$FBRTCLocalMessageQueue0=null;this.$FBRTCLocalMessageQueue1=null;this.$FBRTCLocalMessageQueue2=null;this.$FBRTCLocalMessageQueue3=null;this.$FBRTCLocalMessageQueue4=null;this.$FBRTCLocalMessageQueue5=h.getInstance();}t.prototype.enqueueOffer=function(u,v){"use strict";var w=this.$FBRTCLocalMessageQueue6(u);this.$FBRTCLocalMessageQueue7(w,l,v);};t.prototype.getOffer=function(u){"use strict";var v=this.$FBRTCLocalMessageQueue6(u);return this.$FBRTCLocalMessageQueue8(v,l);};t.prototype.removeOffer=function(u){"use strict";var v=this.$FBRTCLocalMessageQueue6(u);v.remove(l);};t.prototype.maybeEnqueueMessage=function(u,v,w){"use strict";if(!this.$FBRTCLocalMessageQueue9(u))return;var x=this.$FBRTCLocalMessageQueue6(u),y=x.get(n)||0;y++;x.set(n,y,true);var z=m+y.toString();this.$FBRTCLocalMessageQueue7(x,z,w);this.$FBRTCLocalMessageQueue5.logToConsole('Queued '+z);};t.prototype.enableEnqueuing=function(u,v,w){"use strict";this.$FBRTCLocalMessageQueue5.logInfo(u,v,'Enabled enqueuing');if(this.$FBRTCLocalMessageQueue1)clearTimeout(this.$FBRTCLocalMessageQueue1);if(w===(void 0))w=q;if(this.$FBRTCLocalMessageQueue0!==u){var x=this.$FBRTCLocalMessageQueue6(u);this.$FBRTCLocalMessageQueue0=u;x.set(n,0,true);x.set(o,i(0,4294967295),true);}var y=this;this.$FBRTCLocalMessageQueue1=setTimeout(function(){y.$FBRTCLocalMessageQueue5.logInfo(u,v,'Disabled enqueuing');y.$FBRTCLocalMessageQueue0=null;y.$FBRTCLocalMessageQueue1=null;},w);};t.prototype.enableDequeuing=function(u,v,w){"use strict";if(w===(void 0))w=r;this.$FBRTCLocalMessageQueuea(u,v,w);};t.prototype.$FBRTCLocalMessageQueuea=function(u,v,w){"use strict";var x=this.$FBRTCLocalMessageQueue6(u),y=x.get(o);if(y!==this.$FBRTCLocalMessageQueue4){this.$FBRTCLocalMessageQueue4=y;this.$FBRTCLocalMessageQueue3=0;}var z=x.get(n)||0,aa=0;while(this.$FBRTCLocalMessageQueue3<z){this.$FBRTCLocalMessageQueue3++;var ba=m+this.$FBRTCLocalMessageQueue3.toString(),ca=this.$FBRTCLocalMessageQueueb(x,ba);if(ca&&v){v(ca);aa++;}}this.$FBRTCLocalMessageQueue5.logToConsole('Dequeued '+aa+' ('+u+') with '+w+' left)');if(w>0){var da=this;this.$FBRTCLocalMessageQueue2=setTimeout(da.$FBRTCLocalMessageQueuea.bind(da,u,v,w-s),s);}else{this.$FBRTCLocalMessageQueue2=null;this.$FBRTCLocalMessageQueue3=null;this.$FBRTCLocalMessageQueue4=null;}};t.prototype.$FBRTCLocalMessageQueue9=function(u){"use strict";return (this.$FBRTCLocalMessageQueue0===u);};t.prototype.$FBRTCLocalMessageQueue7=function(u,v,w){"use strict";var x={__t:Date.now(),__d:w};u.set(v,x);};t.prototype.$FBRTCLocalMessageQueue8=function(u,v){"use strict";var w=u.get(v);if(w&&this.$FBRTCLocalMessageQueuec(w)){return w.__d;}else if(w)u.remove(v);return null;};t.prototype.$FBRTCLocalMessageQueueb=function(u,v){"use strict";var w=this.$FBRTCLocalMessageQueue8(u,v);if(w!==null){u.remove(v);return w;}return null;};t.prototype.$FBRTCLocalMessageQueuec=function(u){"use strict";return Date.now()-u.__t<p;};t.prototype.$FBRTCLocalMessageQueue6=function(u){"use strict";return new g(j,k+u+'_');};e.exports=t;},null);
__d("FBRTCSdpUtils",[],function(a,b,c,d,e,f){var g='m=video 0',h=function(k){return k.match(/^a=rtpmap:(\d+)\s/)[1];},i=function(k,l,m){var n=h(k[l]),o=k[m].split('RTP/SAVPF'),p=o[1].split(/\s+/),q=p.indexOf(n);p.splice(q,1);o[1]=p.join(' ');k[m]=o.join('RTP/SAVPF');k.splice(l,1);},j={addIceOptionToSdp:function(k,l){"use strict";var m="a=ice-options:",n=k.indexOf(m);if(n>=0){var o=k.indexOf("\r",n);return [k.slice(0,o)," ",l,k.slice(o)].join('');}var p=m+l,q=k.split("\r\n"),r=false,s=-1;for(var t=0;t<q.length;t++){var u=q[t].slice(0,2);if(u=="s="){r=true;continue;}if(r&&u=="a="){s=t;break;}}if(s>=0){q.splice(s,0,p);return q.join("\r\n");}return [k,p,"\r\n"].join('');},preferIsac:function(k){var l=k.split("\r\n"),m=-1,n=-1,o=-1,p=-1;for(var q=0;q<l.length;q++){var r=l[q];if(r.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))m=q;if(p===-1&&m>-1&&r.match(/^a=rtpmap:/))p=q;if(r.match(/^a=rtpmap:\d+\s+ISAC\/16000/))n=q;if(r.match(/^a=rtpmap:\d+\s+ISAC\/32000/))o=q;}if(m===-1||n===-1||p===-1)return l.join("\r\n");var s=l[n];i(l,n,m);l.splice(p,0,s);l[m]=l[m].replace('RTP/SAVPF','RTP/SAVPF '+h(s));if(o>-1)i(l,o,m);return l.join("\r\n");},disableVideo:function(k){var l=/m=video\s+\S+/;k=k.replace(l,g);return k;},isVideoSupported:function(k){return (k&&k.indexOf('m=video')>-1&&k.indexOf(g)===-1);}};e.exports=j;},null);
__d("FBRTCMessage",["CurrentUser","FBRTCConstants","FBRTCSdpUtils","PresencePrivacy"],function(a,b,c,d,e,f,g,h,i,j){var k='mobile';function l(m){"use strict";if(!this.$FBRTCMessage0(m))throw 'invalid webrtc message';this.peerID=m.from;this.callID=parseInt(m.call_id,10);this.msg=JSON.parse(m.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.source=m.source;this.$FBRTCMessage1();}l.prototype.$FBRTCMessage0=function(m){"use strict";return m.from&&m.call_id&&m.payload;};l.prototype.$FBRTCMessage1=function(){"use strict";if(this.isFromMobile()){if(this.msg.sdp)this.msg.sdp=i.disableVideo(this.msg.sdp);if(this.msgType===h.PayloadType.SET_VIDEO||this.msgType===h.PayloadType.OFFER||this.msgType===h.PayloadType.ICERESTART_OFFER||this.msgType===h.PayloadType.ANSWER||this.msgType===h.PayloadType.ICERESTART_ANSWER)this.msg.videoon=false;}};l.prototype.isOffer=function(){"use strict";return this.msgType===h.PayloadType.OFFER;};l.prototype.isFromMobile=function(){"use strict";return (this.source===k);};l.prototype.isForCall=function(m){"use strict";return !m.callID||m.callID===this.callID||this.msgType===h.PayloadType.OFFER||this.msgType===h.PayloadType.ICERESTART_OFFER||this.msgType===h.PayloadType.ICE_CANDIDATE;};l.prototype.isFromVisiblePeer=function(){"use strict";return (g.getID()===this.peerID||j.allows(this.peerID));};e.exports=l;},null);
__d("FBRTCMessageDedup",[],function(a,b,c,d,e,f){var g={},h={check:function(i,j,k){if(!g[i])g[i]={};if(!g[i][j])g[i][j]={};if(g[i][j][k])return false;g[i][j][k]=true;return true;}};e.exports=h;},null);
__d("XVideoCallSendMessageController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/videocall\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});},null);
__d("SamplingPolicyBase",[],function(a,b,c,d,e,f){function g(){"use strict";throw 'Tried to instantiate SamplingPolicyBase';}g.prototype.getName=function(){"use strict";return this.name;};g.prototype.isSampled=function(){"use strict";if(typeof(this.sampled)=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};e.exports=g;},null);
__d("FbtraceForcedByServerPolicy",["FbtraceForcedByServer","SamplingPolicyBase","copyProperties"],function(a,b,c,d,e,f,g,h,i){'use strict';var j;function k(){this.name='FbtraceForcedByServerPolicy';}k.get=function(){if(typeof(j)=='undefined')j=new k();return j;};function l(){return g.forced;}i(k.prototype,h.prototype,{decideIfSampled:l});e.exports=k;},null);
__d("Random",["Alea","ServerNonce"],function(a,b,c,d,e,f,g){'use strict';var h=b('ServerNonce').ServerNonce,i=g(h),j={random:i,uint32:function(){return Math.floor(i()*4294967296);}};e.exports=j;},null);
__d("guardFunction",[],function(a,b,c,d,e,f){function g(h,i,j){return function(){if(h.apply(j||this,arguments))i.apply(j||this,arguments);};}e.exports=g;},null);
__d("Fbtrace",["Arbiter","BanzaiScribe","ErrorUtils","FbtraceForcedByServer","FbtraceForcedByServerPolicy","Random","SiteData","copyProperties","guardFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';var p='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',q='AAAAAAAAAAA';for(var r in Error)if(Error.hasOwnProperty(r))t[r]=Error[r];var s=Error===null?null:Error.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=Error;function t(ia){Error.call(this,ia);}function u(ia){i.reportError(new t(ia));}function v(){var ia=function(){var la=0,ma=0,na='';for(var oa=10;oa>=0;oa--){if(la<6){ma=l.uint32();la=32;}if(oa===0)ma=ma&7;na=p.charAt(ma&63)+na;ma>>=6;la-=6;}return na;},ja,ka;for(ja=3;ja>0;ja--){ka=ia();if(ka!=q)return ka;}u('failed to generate valid Fbtrace id');return q;}function w(){n(this,w);}n(w,{isOn:function(){return false;},replySend:function(ia,ja){},requestSend:function(ia,ja,ka){ca(ia,ja);return {metadata:function(){return (void 0);},replyReceive:function(la){}};}});var x=new w();function y(ia,ja,ka){if(!ia)throw {name:'ArgumentError',message:'no valid service name specified'};if(!ja)throw {name:'ArgumentError',message:'no valid version specified'};var la=h,ma=0,na=v(),oa=v(),pa=ba(na),qa={service:ia,version:ja},ra=function(wa){if(typeof(wa)=='undefined')return 'undefined';if(typeof(wa)!='string')wa=ra(JSON.stringify(wa));return wa;},sa=function(wa){var xa='';for(var ya in wa){if(xa.length>0)xa+='\x02';xa+=ra(ya)+'\x03'+ra(wa[ya]);}return xa;},ta=function(wa,xa,event,ya,za){ma++;return [za,ma,na,wa,xa,ra(event),sa(ya)].join('\x01');},ua=function(wa,xa,event,ya,za){if(!za&&typeof(za)=='undefined')za=Date.now()*1000;var ab=ta(wa,xa,event,ya,za);la.log('fbtrace',ab,pa);},va=function(){return oa;};ua(q,oa,'#rqrecv',n(ka,qa));n(this,y);n(this,{replySend:function(wa,xa){xa=n(xa,qa,{success:wa?'true':'false'});ua(q,oa,'#rpsend',xa);},requestSend:function(wa,xa,ya){ca(wa,xa);var za=va(),ab=v();ya=n(ya,qa,{op:wa,'remote:service':xa});ua(za,ab,'#rqsend',ya);return {metadata:function(){return na+ab;},replyReceive:function(bb){ua(za,ab,'#rprecv',n(bb,qa));},parentNode:this};}});}n(y,{isOn:function(){return true;}});function z(){return x;}function aa(ia,ja,ka){ka=ka||{};ka.init=true;var la=k.get();if(la.isSampled()){return new y(ia,ja,ka);}else return new w();}function ba(ia){var ja=ia.charAt(ia.length-1);return p.indexOf(ja)%32;}function ca(ia,ja){if(!ia)throw {name:'ArgumentError',message:'no valid operation specified'};if(!ja)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function da(ia,ja){var ka=x,la;x=ia;try{la=ja();}finally{x=ka;}return la;}var ea=function(ia,ja){var ka=z(),la=ja.request,ma=false;if(!ka.isOn()&&j.forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(la.uri.toString())){ka=aa('photo_upload_kludge',String(m.revision||'dev'),{policy:'PhotoUpload'});ma=true;}if(ka.isOn()){var na=ma?{policy:'PhotoUpload'}:{};if(la.userActionId)na.user_action_id=la.userActionId;var oa=ka.requestSend(la.uri.toString(),'www',na);la.fbtraceRemoteNode=oa;la.transport.setRequestHeader('X-Fbtrace-Meta',oa.metadata());}},fa=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:true});setTimeout(function(){ja.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},ga=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:false,error_code:ja.response.error,error_summary:ja.response.errorSummary,error_description:ja.response.errorDescription});setTimeout(function(){ja.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},ha=function(ia,ja){return ja.request.fbtraceRemoteNode;};g.subscribe('AsyncRequest/will_send',ea);g.subscribe('AsyncRequest/response',o(ha,fa));g.subscribe('AsyncRequest/error',o(ha,ga));e.exports={defaultNode:z,requestReceive:aa,withDefaultNode:da};},null);
__d("FBRTCMessageSender",["CurrentUser","XVideoCallSendMessageController","FBRTCConstants","FBRTCLogger","FBRTCUtils","SiteData","Fbtrace","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=0;function p(){"use strict";this.onSendFailure=null;this.$FBRTCMessageSender0=j.getInstance();}p.prototype.sendOffer=function(q,r,s,t){"use strict";var u=this.$FBRTCMessageSender1(r,i.PayloadType.OFFER);u.sdp=s;u.handlescollision=true;u.videoon=t;this.$FBRTCMessageSender2(q,u);return this.$FBRTCMessageSender3(q,u);};p.prototype.sendAnswer=function(q,r,s,t){"use strict";var u=this.$FBRTCMessageSender1(r,i.PayloadType.ANSWER);u.sdp=s;u.videoon=t;this.$FBRTCMessageSender2(q,u);return this.$FBRTCMessageSender3(q,u);};p.prototype.sendIceCandidate=function(q,r,s){"use strict";var t=this.$FBRTCMessageSender1(r,i.PayloadType.ICE_CANDIDATE);t.sdp_mid=s.sdpMid;t.label=s.sdpMLineIndex;t.sdp=s.candidate;this.$FBRTCMessageSender4(q,t);};p.prototype.sendHangup=function(q,r,s,t){"use strict";var u=this.$FBRTCMessageSender1(r,i.PayloadType.HANGUP);u.reason=i.callEndReasonString(s);this.$FBRTCMessageSender4(q,u,t);};p.prototype.sendOtherDismiss=function(q){"use strict";var r=this.$FBRTCMessageSender1(q,i.PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(g.getID(),r);};p.prototype.sendOfferAck=function(q,r,s){"use strict";this.$FBRTCMessageSender5(q,r,s,i.PayloadType.OFFER_ACK);};p.prototype.sendOfferNack=function(q,r,s){"use strict";this.$FBRTCMessageSender5(q,r,s,i.PayloadType.OFFER_NACK,1356043);};p.prototype.sendAnswerAck=function(q,r,s){"use strict";this.$FBRTCMessageSender5(q,r,s,i.PayloadType.ANSWER_ACK);};p.prototype.sendIcerestartOffer=function(q,r,s){"use strict";var t=this.$FBRTCMessageSender1(r,i.PayloadType.ICERESTART_OFFER);t.sdp=s;t.handlescollision=true;t.icerestart=true;this.$FBRTCMessageSender2(q,t);return this.$FBRTCMessageSender3(q,t);};p.prototype.sendMuteStateUpdate=function(q,r,s){"use strict";var t=this.$FBRTCMessageSender1(r,i.PayloadType.SET_VIDEO);t.videoon=s;this.$FBRTCMessageSender4(q,t);};p.prototype.sendMsgAck=function(){"use strict";};p.prototype.sendOk=function(){"use strict";};p.prototype.sendPranswer=function(){"use strict";};p.prototype.sendIcerestartAnswer=function(){"use strict";};p.prototype.$FBRTCMessageSender1=function(q,r){"use strict";var s=k.generateRandomInt(),t={version:o,type:r,call_id:q,msg_id:s};return t;};p.prototype.$FBRTCMessageSender3=function(q,r){"use strict";r.flag=1;return this.$FBRTCMessageSender2.bind(this,q,r);};p.prototype.$FBRTCMessageSender2=function(q,r){"use strict";this.$FBRTCMessageSender4(q,r,false,true,true);};p.prototype.$FBRTCMessageSender5=function(q,r,s,t,u){"use strict";var v=this.$FBRTCMessageSender1(r,t);v.ack_id=s.msg_id;if(s.flag===1)v.flag=1;if(u!==(void 0))s.errorCode=u;this.$FBRTCMessageSender4(q,v);};p.prototype.$FBRTCMessageSender4=function(q,r,s,t,u){"use strict";var v=r.msg_id,w={peer_id:q,call_id:r.call_id,msg_id:v,msg_type:r.type},x={};n(x,w);x.op='sendServerRequest:'+r.type;x.policy='WebRTC';var y=m.requestReceive('browser',String(l.revision||'dev'),x),z=(h.getURIBuilder()).setInt('recipient_id',q).setInt('msg_id',v).setString('message_info',JSON.stringify(r)).setInt('webrtc_fbtrace',y.isOn()?1:0).getURI();if(t)var aa=this.$FBRTCMessageSender4.bind(this,q,r,s,false,u);var ba=this.$FBRTCMessageSender6.bind(this,w),ca=this.$FBRTCMessageSender7.bind(this,w,aa,u);m.withDefaultNode(y,function(){k.sendServerRequest(z,ba,ca,s);});if(this.onMessageSent)this.onMessageSent(q,r);this.$FBRTCMessageSender0.logSentMessage(q,r.call_id,r);};p.prototype.$FBRTCMessageSender6=function(q){"use strict";this.$FBRTCMessageSender0.logSentMessageSuccess(q.peer_id,q.call_id,q.msg_type,q.msg_id);};p.prototype.$FBRTCMessageSender7=function(q,r,s,t){"use strict";if(t)var u=t.getError?t.getError():t;this.$FBRTCMessageSender0.logSentMessageFailure(q.peer_id,q.call_id,q.msg_type,q.msg_id,u);if(this.onSendFailure){var v=null;if(u===1356001||u===1356049){v=i.CallEndReason.NO_PERMISSION;}else if(u===1356046||u===1356045){v=i.CallEndReason.CALLER_NOT_VISIBLE;}else if(u===1356003||u===1356002||u===1356044||u===1356048){v=i.CallEndReason.OTHER_NOT_CAPABLE;}else if(r){r();return;}else if(s)v=i.CallEndReason.SIGNALING_MESSAGE_FAILED;if(v)this.onSendFailure(v,u);}};e.exports=p;},null);
__d("XVideoCallMissedCallController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/videocall\/missed_call\/",{user_id:{type:"Int",required:true},__asyncDialog:{type:"Int"}});},null);
__d("FBRTCMissedVideoCallHandler",["AsyncDialog","AsyncRequest","FBRTCLogger","MissedVideoCallHandler","VideoCallSupport","XVideoCallMissedCallController"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=null,n=null;o.hideDialog=function(){"use strict";if(m){m.hide();m=null;n=null;j.setSuppressAll(false);}};function o(p){"use strict";this.$FBRTCMissedVideoCallHandler0=p;this.$FBRTCMissedVideoCallHandler1=null;}o.prototype.onCallMissed=function(p){"use strict";if(!k.isWebrtcSupported())return;if(n===null)this.$FBRTCMissedVideoCallHandler1=p;};o.prototype.showDialog=function(){"use strict";if(!this.$FBRTCMissedVideoCallHandler1||n)return;j.setSuppressAll(true);n=this.$FBRTCMissedVideoCallHandler1;this.$FBRTCMissedVideoCallHandler1=null;var p=l.getURIBuilder().setInt('user_id',n).getURI(),q=new h(p);g.send(q,this.$FBRTCMissedVideoCallHandler2.bind(this));};o.prototype.$FBRTCMissedVideoCallHandler2=function(p){"use strict";m=p;p.subscribe('confirm',this.$FBRTCMissedVideoCallHandler3.bind(this));p.subscribe('cancel',this.$FBRTCMissedVideoCallHandler4.bind(this));};o.prototype.$FBRTCMissedVideoCallHandler3=function(){"use strict";this.$FBRTCMissedVideoCallHandler0.showOutgoingCallDialog(n,'missed_call_dialog',i.Trigger.RETURN_CALL);o.hideDialog();};o.prototype.$FBRTCMissedVideoCallHandler4=function(){"use strict";o.hideDialog();};e.exports=o;},null);
__d("FBRTCIncomingCallController",["Banzai","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCCallUI","FBRTCConstants","FBRTCIceCache","FBRTCIncomingCall","FBRTCLocalMessageQueue","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageSender","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(w){"use strict";this.$FBRTCIncomingCallController0=null;this.$FBRTCIncomingCallController1=new s(w);this.$FBRTCIncomingCallController2=new r();this.$FBRTCIncomingCallController3=new n();this.$FBRTCIncomingCallController4=i.getInstance();this.$FBRTCIncomingCallController5=new l();this.$FBRTCIncomingCallController6=o.getInstance();w.setRTCMessageHandler(this.$FBRTCIncomingCallController7.bind(this));g.subscribe(g.SEND,h.logSavedSummaries.bind(this,this.$FBRTCIncomingCallController4));}v.prototype.startingCallTo=function(w,x){"use strict";this.$FBRTCIncomingCallController3.enableEnqueuing(w,x);};v.prototype.$FBRTCIncomingCallController7=function(w){"use strict";var x;try{x=new p(w);}catch(y){this.$FBRTCIncomingCallController6.logErrorWithoutID('Unknown data: '+JSON.stringify(w));return;}if(!x.isFromVisiblePeer()){this.$FBRTCIncomingCallController6.logInfo(x.peerID,x.callID,'Invisible Peer');return;}if(!q.check(x.peerID,x.callID,x.msgID)){this.$FBRTCIncomingCallController6.logInfo(x.peerID,x.callID,'Ignoring message (duplicate): '+x.msgID);return;}this.$FBRTCIncomingCallController6.logReceivedMessage(x.peerID,x.callID,x.msg);if(u.isWebrtcSupported())this.$FBRTCIncomingCallController3.maybeEnqueueMessage(x.peerID,x.callID,w);switch(x.msgType){case k.PayloadType.OFFER:this.$FBRTCIncomingCallController8(x);break;case k.PayloadType.HANGUP:this.$FBRTCIncomingCallController9(x);break;case k.PayloadType.OTHER_DISMISS:this.$FBRTCIncomingCallControllera();break;case k.PayloadType.ICE_CANDIDATE:if(u.isWebrtcSupported())this.$FBRTCIncomingCallController5.cacheCandidate(x.peerID,x.callID,w);break;case k.PayloadType.OFFER_ACK:if(u.isWebrtcSupported()){this.$FBRTCIncomingCallController3.enableEnqueuing(x.peerID,x.callID);this.$FBRTCIncomingCallController3.maybeEnqueueMessage(x.peerID,x.callID,w);}break;case k.PayloadType.ANSWER:case k.PayloadType.MSG_ACK:case k.PayloadType.OK:case k.PayloadType.PING:case k.PayloadType.PRANSWER:case k.PayloadType.ICERESTART_OFFER:case k.PayloadType.ICERESTART_ANSWER:case k.PayloadType.ANSWER_ACK:case k.PayloadType.SET_VIDEO:case k.PayloadType.OFFER_NACK:break;default:break;}};v.prototype.$FBRTCIncomingCallController8=function(w){"use strict";var x=w.peerID,y=w.callID,z=w.msg;if(u.isWebrtcSupported()){this.$FBRTCIncomingCallController2.sendOfferAck(x,y,z);}else this.$FBRTCIncomingCallController2.sendOfferNack(x,y,z);this.$FBRTCIncomingCallController6.logCallAction(x,y,o.CallAction.RECEIVED_CALL);var aa=this.$FBRTCIncomingCallControllerb(x,y,w);if(this.$FBRTCIncomingCallController0!==null&&!this.$FBRTCIncomingCallController0.isForPeer(x)){this.$FBRTCIncomingCallControllerc(x,y,aa,k.CallEndReason.IN_ANOTHER_CALL,false,false,true);this.$FBRTCIncomingCallController1.onCallMissed(x);return;}if(!u.isWebrtcSupported()){this.$FBRTCIncomingCallControllerc(x,y,aa,k.CallEndReason.UNSUPPORTED_VERSION,false,false,false);t.showForIncomingCall(y,x);return;}this.$FBRTCIncomingCallController0=new m(x,y,aa,z);this.$FBRTCIncomingCallController0.onAnswer=this.$FBRTCIncomingCallControllerd.bind(this);this.$FBRTCIncomingCallController0.onIgnore=this.$FBRTCIncomingCallControllere.bind(this);this.$FBRTCIncomingCallController0.onTimeout=this.$FBRTCIncomingCallControllerf.bind(this);s.hideDialog();this.$FBRTCIncomingCallController0.showIncomingDialog();this.$FBRTCIncomingCallController6.logEvent(x,y,'Incoming call dialog shown');};v.prototype.$FBRTCIncomingCallController9=function(w){"use strict";var x=w.peerID,y=w.callID,z=w.msg;if(this.$FBRTCIncomingCallController0&&this.$FBRTCIncomingCallController0.isForPeerAndCall(x,y)){var aa=z.reason;if(typeof aa=='string'||aa instanceof String)aa=k.endCallReasonFromString(aa);this.$FBRTCIncomingCallController0.cancel();this.$FBRTCIncomingCallControllerc(x,y,this.$FBRTCIncomingCallController0.callSummary,aa,true,true,false);this.$FBRTCIncomingCallController0.cancel();this.$FBRTCIncomingCallController0=null;if(aa!==k.CallEndReason.OTHER_INSTANCE_HANDLED){this.$FBRTCIncomingCallController1.onCallMissed(x);this.$FBRTCIncomingCallController1.showDialog();}}};v.prototype.$FBRTCIncomingCallControllera=function(){"use strict";t.dismiss();if(this.$FBRTCIncomingCallController0){this.$FBRTCIncomingCallController0.cancel();this.$FBRTCIncomingCallController0=null;}};v.prototype.$FBRTCIncomingCallControllerb=function(w,x,y){"use strict";var z=new h({peerID:w,callID:x,isCaller:false});z.onFullMessageReceived(y);z.onOfferAckSent(y.msg);return z;};v.prototype.$FBRTCIncomingCallControllerd=function(w,x,y,z,aa){"use strict";this.$FBRTCIncomingCallController6.logCallAction(w,x,o.CallAction.ANSWER_CALL);this.$FBRTCIncomingCallController2.sendOtherDismiss(x);this.$FBRTCIncomingCallController3.enableEnqueuing(w,x);this.$FBRTCIncomingCallController3.enqueueOffer(w,y);var ba=this;this.$FBRTCIncomingCallController5.drainCandidates(w,x,function(ca){ba.$FBRTCIncomingCallController3.maybeEnqueueMessage(w,x,ca);});j.openAsCallee(w,x,z,aa);this.$FBRTCIncomingCallController0=null;this.$FBRTCIncomingCallController1.showDialog();};v.prototype.$FBRTCIncomingCallControllere=function(w,x,y){"use strict";this.$FBRTCIncomingCallControllerc(w,x,y,k.CallEndReason.IGNORE_CALL,false,true,false);this.$FBRTCIncomingCallController0=null;};v.prototype.$FBRTCIncomingCallControllerf=function(w,x,y){"use strict";this.$FBRTCIncomingCallControllerc(w,x,y,k.CallEndReason.NO_ANSWER_TIMEOUT,false,false,false);this.$FBRTCIncomingCallController0=null;this.$FBRTCIncomingCallController1.onCallMissed(w);this.$FBRTCIncomingCallController1.showDialog();};v.prototype.$FBRTCIncomingCallControllerc=function(w,x,y,z,aa,ba,ca){"use strict";if(ca)this.$FBRTCIncomingCallController2.sendHangup(w,x,z);if(ba)this.$FBRTCIncomingCallController2.sendOtherDismiss(x);y.onCallEnded(z,aa);y.save(this.$FBRTCIncomingCallController4);var da=k.fullCallEndReasonString(z,aa);this.$FBRTCIncomingCallController6.logCallAction(w,x,o.CallAction.END_CALL,da);};e.exports=v;},null);
__d("MercuryTypeaheadDataSource",["Banzai","BanzaiLogger","CurrentUser","DataSource","MercuryParticipantTypes","MercuryTypeaheadConstants","OrderedFriendsList","ShortProfiles","debounce","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=500,r=[],s={},t={},u={},v=false,w=false;for(var x in j)if(j.hasOwnProperty(x))z[x]=j[x];var y=j===null?null:j.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=j;function z(aa){"use strict";aa=aa||{};aa.kanaNormalization=true;j.call(this,aa);this.logQuery=o(function(ba){this.$MercuryTypeaheadDataSource0(ba);},q,this,true);this.logResponse=o(function(ba){this.$MercuryTypeaheadDataSource0(ba);},q,this,true);}z.prototype.dirty=function(){"use strict";this.$MercuryTypeaheadDataSource1=r;this.localCache=t;this.queryCache=s;this.queryIDs=u;return this;};z.prototype.bootstrap=function(){"use strict";if(v||w)return false;this.$MercuryTypeaheadDataSource0({event:'bootstrap_start'});w=true;n.fetchAll().then(function(){this.updateBootstrapData();this.$MercuryTypeaheadDataSource0({event:'bootstrap_end'});w=false;v=true;}.bind(this),function(){this.$MercuryTypeaheadDataSource0({event:'bootstrap_failure'});}.bind(this));return true;};z.prototype.updateBootstrapData=function(){"use strict";var aa=this.getCachedShortProfileIDs(),ba=aa.map(function(ca){var da=n.getNow(ca),ea=ca==i.getID()?k.FRIEND:da.type,fa=[da.additionalName,da.alternateName].concat(da.searchTokens||[]).join(' ');return {uid:ca,index:m.getActiveRank(ca),text:da.name,tokens:fa,localized_text:da.name,additional_text:da.additionalName,photo:da.thumbSrc,render_type:ea,type:l.USER_TYPE};});if(ba.length)this.addEntries(ba);};z.prototype.query=function(aa,ba,ca,da){"use strict";var ea=ba||aa.length===1;return y.query.call(this,aa,ea,ca,da);};z.prototype.getQueryData=function(aa,ba){"use strict";return p(y.getQueryData.call(this,aa,ba),{needs_friends:!this.isBootstrapped()});};z.prototype.setEntry=function(aa,ba){"use strict";this.$MercuryTypeaheadDataSource1[aa]=ba;};z.prototype.getEntry=function(aa){"use strict";return this.$MercuryTypeaheadDataSource1[aa]||null;};z.prototype.getCachedShortProfileIDs=function(){"use strict";var aa=n.getCachedProfileIDs(),ba=aa.filter(function(ca){var da=n.getNow(ca);return (ca==i.getID()||da.type===k.FRIEND);});return ba;};z.prototype.isBootstrapped=function(){"use strict";return v;};z.prototype.isBootstrapping=function(){"use strict";return w;};z.prototype.$MercuryTypeaheadDataSource0=function(aa){"use strict";if(!g.isEnabled('mercury_typeahead_logging'))return;h.log('MercuryQueryResultsLoggerConfig',aa);};e.exports=z;},null);
__d("ChatTabTypeaheadDataSource",["MercuryTypeaheadConstants","MercuryTypeaheadDataSource"],function(a,b,c,d,e,f,g,h){for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(l){"use strict";l=l||{};l.maxResults=g.COMPOSER_CHATTAB_MAX;h.call(this,l);this.$ChatTabTypeaheadDataSource0=true;}k.prototype.buildData=function(l){"use strict";var m=[],n=[],o=[],p=[],q=[];l.forEach(function(r){var s=j.getEntry.call(this,r);switch(s.render_type){case g.FRIEND_TYPE:m.push(r);break;case g.THREAD_TYPE:if(this.$ChatTabTypeaheadDataSource0)n.push(r);break;case g.NON_FRIEND_TYPE:o.push(r);break;case g.FB4C_TYPE:p.push(r);break;case g.PAGE_TYPE:if(this.$ChatTabTypeaheadDataSource0)q.push(r);break;default:this.logQuery({event:'chat_tab_render_type_error'});break;}},this);return j.buildData.call(this,m.concat(p,n,q,o));};k.prototype.query=function(l,m,n,o){"use strict";this.logQuery({event:'query_chat_tab',query:l});return j.query.call(this,l,m,n,o);};k.prototype.respond=function(l,m,n){"use strict";var o=j.respond.call(this,l,m,n);this.logResponse({event:'query_response_chat_tab',response_query:l,response_uids:m});return o;};k.prototype.setShowThreads=function(l){"use strict";this.$ChatTabTypeaheadDataSource0=l;};e.exports=k;},null);
__d("MercuryThreadSearchUtils",["escapeRegex","TokenizeUtil"],function(a,b,c,d,e,f,g,h){var i={wordsInString:function(j){return (j||'').split(/\s+/).filter(function(k){return k.trim().length>0;});},anyMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(k(j[l]))return true;return false;},allMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(!k(j[l]))return false;return true;},queryWordMatchesAnyNameWord:function(j,k){var l=new RegExp('^'+g(j),'i');return this.anyMatchPredicate(k,function(m){var n=h.parse(m).flatValue;return l.test(n);});},queryMatchesName:function(j,k){var l=this.wordsInString(j),m=this.wordsInString(k);return this.allMatchPredicate(l,function(n){return this.queryWordMatchesAnyNameWord(n,m);}.bind(this));}};e.exports=i;},null);
__d("SyncRequestNotificationBeeperItemContents.react",["Animation","CloseButton.react","ImageBlock.react","NotificationUserActions","React","SyncRequest.react","SyncRequestStatusEnum","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=k.createClass({displayName:"SyncRequestNotificationBeeperItemContents",_markAsRead:function(){j.markNotificationsAsRead([this.props.beep.notificationID]);this.props.onHide();},_onClose:function(){this._markAsRead();this.props.onHide();},_doFlash:function(){new g(this.refs.inner.getDOMNode()).from('opacity','0').to('opacity','1').duration(200).go();},componentDidMount:function(){if(this.props.beep.rendererData.status!=m.PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},componentDidUpdate:function(p){if(this.props.beep.rendererData.status!=m.PENDING&&p.beep.rendererData.status==m.PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},onRequestStatusUpdate:function(p,q){if(p!=m.PENDING&&q==m.PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},render:function(){var p=this.props.beep,q=p.rendererData;return (k.createElement("div",{ref:"inner"},k.createElement(h,{className:"_3soc",onClick:this._onClose,size:"medium"}),k.createElement(i,{className:"_3soj"},k.createElement("img",{src:p.actors[0].profile_picture.uri,className:"_3sok"}),k.createElement("div",{className:"_3sol"},k.createElement(l,{app:q.app,creationTime:q.creation_time,requestId:q.id.toString(),receiver:q.receiver,sender:q.sender,status:q.status,timeout:q.timeout,timeRemaining:q.time_remaining,viewerId:q.receiver.id,onStatusUpdate:this.onRequestStatusUpdate})))));}});e.exports=o;},null);
__d("LiveMessageReceiver",["Arbiter","ChannelConstants","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m){this.eventName=m;this.subs=null;this.handler=j;this.shutdownHandler=null;this.registered=false;this.appId=1;}i(l,{getAppMessageType:function(m,n){return 'live_message/'+m+':'+n;},route:function(m){var n=function(o){var p=l.getAppMessageType(m.app_id,m.event_name);g.inform(p,o,g.BEHAVIOR_PERSISTENT);};n(m.response);}});i(l.prototype,{setAppId:function(m){this.appId=m;return this;},setHandler:function(m){this.handler=m;this._dirty();return this;},setRestartHandler:j,setShutdownHandler:function(m){this.shutdownHandler=k(m);this._dirty();return this;},_dirty:function(){if(this.registered){this.unregister();this.register();}},register:function(){var m=function(o,p){return this.handler(p);}.bind(this),n=l.getAppMessageType(this.appId,this.eventName);this.subs={};this.subs.main=g.subscribe(n,m);if(this.shutdownHandler)this.subs.shut=g.subscribe(h.ON_SHUTDOWN,this.shutdownHandler);this.registered=true;return this;},unregister:function(){if(!this.subs)return this;for(var m in this.subs)if(this.subs[m])this.subs[m].unsubscribe();this.subs=null;this.registered=false;return this;}});e.exports=l;},null);
__d("initLiveMessageReceiver",["Arbiter","ChannelConstants","LiveMessageReceiver"],function(a,b,c,d,e,f,g,h,i){g.subscribe(h.getArbiterType('app_msg'),function(j,k){i.route(k.obj);});},null);
__d("ClearableTypeahead",["Event"],function(a,b,c,d,e,f,g){var h={resetOnCloseButtonClick:function(i,j){g.listen(j,'click',function(){var k=i.getCore();k.getElement().focus();k.reset();});}};e.exports=h;},null);
__d("legacy:CompactTypeaheadRenderer",["CompactTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.compact=b('CompactTypeaheadRenderer');},3);